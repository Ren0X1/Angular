window.onload = function() {
    var jObj = '{"44":{"provinciaseo":"vizcaya","Abreviatura":"VZC","idprovincia":44,"provincia":"Vizcaya","comunidad":"PVC"},"45":{"provinciaseo":"cadiz","Abreviatura":"CDZ","idprovincia":45,"provincia":"C�diz","comunidad":"AND"},"46":{"provinciaseo":"huesca","Abreviatura":"HSC","idprovincia":46,"provincia":"Huesca","comunidad":""},"47":{"provinciaseo":"pontevedra","Abreviatura":"PNV","idprovincia":47,"provincia":"Pontevedra","comunidad":""},"48":{"provinciaseo":"zamora","Abreviatura":"ZAM","idprovincia":48,"provincia":"Zamora","comunidad":""},"49":{"provinciaseo":"cantabria","Abreviatura":"CTB","idprovincia":49,"provincia":"Cantabria","comunidad":""},"50":{"provinciaseo":"jaen","Abreviatura":"JAE","idprovincia":50,"provincia":"Ja�n","comunidad":"AND"},"51":{"provinciaseo":"rioja","Abreviatura":"LRJ","idprovincia":51,"provincia":"La Rioja","comunidad":""},"52":{"provinciaseo":"zaragoza","Abreviatura":"ZAR","idprovincia":52,"provincia":"Zaragoza","comunidad":""},"10":{"provinciaseo":"ciudad-real","Abreviatura":"CRE","idprovincia":10,"provincia":"Ciudad Real","comunidad":"CLM"},"11":{"provinciaseo":"lugo","Abreviatura":"LUG","idprovincia":11,"provincia":"Lugo","comunidad":"GAL"},"12":{"provinciaseo":"sevilla","Abreviatura":"SVL","idprovincia":12,"provincia":"Sevilla","comunidad":"AND"},"13":{"provinciaseo":"almeria","Abreviatura":"ALM","idprovincia":13,"provincia":"Almer�a","comunidad":"AND"},"14":{"provinciaseo":"cordoba","Abreviatura":"CBA","idprovincia":14,"provincia":"C�rdoba","comunidad":"AND"},"15":{"provinciaseo":"madrid","Abreviatura":"MAD","idprovincia":15,"provincia":"Madrid","comunidad":"MAD"},"16":{"provinciaseo":"soria","Abreviatura":"SOR","idprovincia":16,"provincia":"Soria","comunidad":"CYL"},"17":{"provinciaseo":"asturias","Abreviatura":"AST","idprovincia":17,"provincia":"Asturias","comunidad":"AST"},"18":{"provinciaseo":"coruna","Abreviatura":"LCO","idprovincia":18,"provincia":"A Coru�a","comunidad":"GAL"},"19":{"provinciaseo":"malaga","Abreviatura":"MAL","idprovincia":19,"provincia":"M�laga","comunidad":"AND"},"1":{"provinciaseo":"alava","Abreviatura":"ALV","idprovincia":1,"provincia":"�lava","comunidad":"PVC"},"2":{"provinciaseo":"castellon","Abreviatura":"CAS","idprovincia":2,"provincia":"Castell�n","comunidad":"VAL"},"3":{"provinciaseo":"leon","Abreviatura":"LEO","idprovincia":3,"provincia":"Le�n","comunidad":"CYL"},"4":{"provinciaseo":"salamanca","Abreviatura":"SAL","idprovincia":4,"provincia":"Salamanca","comunidad":"CYL"},"5":{"provinciaseo":"albacete","Abreviatura":"ABC","idprovincia":5,"provincia":"Albacete","comunidad":"CLM"},"6":{"provinciaseo":"ceuta","Abreviatura":"CEU","idprovincia":6,"provincia":"Ceuta","comunidad":""},"7":{"provinciaseo":"lleida","Abreviatura":"LLE","idprovincia":7,"provincia":"Lleida","comunidad":"CAT"},"8":{"provinciaseo":"segovia","Abreviatura":"SGV","idprovincia":8,"provincia":"Segovia","comunidad":"CYL"},"9":{"provinciaseo":"alicante","Abreviatura":"ALA","idprovincia":9,"provincia":"Alicante","comunidad":"VAL"},"20":{"provinciaseo":"tarragona","Abreviatura":"TRN","idprovincia":20,"provincia":"Tarragona","comunidad":"CAT"},"21":{"provinciaseo":"avila","Abreviatura":"AVL","idprovincia":21,"provincia":"�vila","comunidad":""},"22":{"provinciaseo":"cuenca","Abreviatura":"CNC","idprovincia":22,"provincia":"Cuenca","comunidad":""},"23":{"provinciaseo":"melilla","Abreviatura":"MEL","idprovincia":23,"provincia":"Melilla","comunidad":""},"24":{"provinciaseo":"tenerife","Abreviatura":"SCT","idprovincia":24,"provincia":"S.C. Tenerife","comunidad":""},"25":{"provinciaseo":"badajoz","Abreviatura":"BDJ","idprovincia":25,"provincia":"Badajoz","comunidad":"EXT"},"26":{"provinciaseo":"girona","Abreviatura":"GIR","idprovincia":26,"provincia":"Girona","comunidad":""},"27":{"provinciaseo":"murcia","Abreviatura":"MUR","idprovincia":27,"provincia":"Murcia","comunidad":""},"28":{"provinciaseo":"teruel","Abreviatura":"TER","idprovincia":28,"provincia":"Teruel","comunidad":""},"29":{"provinciaseo":"baleares","Abreviatura":"BAL","idprovincia":29,"provincia":"Baleares","comunidad":""},"30":{"provinciaseo":"granada","Abreviatura":"GND","idprovincia":30,"provincia":"Granada","comunidad":"AND"},"31":{"provinciaseo":"navarra","Abreviatura":"NVR","idprovincia":31,"provincia":"Navarra","comunidad":""},"32":{"provinciaseo":"toledo","Abreviatura":"TOL","idprovincia":32,"provincia":"Toledo","comunidad":""},"33":{"provinciaseo":"barcelona","Abreviatura":"BCN","idprovincia":33,"provincia":"Barcelona","comunidad":""},"34":{"provinciaseo":"guadalajara","Abreviatura":"GLJ","idprovincia":34,"provincia":"Guadalajara","comunidad":""},"35":{"provinciaseo":"ourense","Abreviatura":"OUR","idprovincia":35,"provincia":"Ourense","comunidad":""},"36":{"provinciaseo":"valencia","Abreviatura":"VAL","idprovincia":36,"provincia":"Valencia","comunidad":""},"37":{"provinciaseo":"burgos","Abreviatura":"BRG","idprovincia":37,"provincia":"Burgos","comunidad":""},"38":{"provinciaseo":"guipuzcoa","Abreviatura":"GPZ","idprovincia":38,"provincia":"Guip�zcoa","comunidad":"PVC"},"39":{"provinciaseo":"palencia","Abreviatura":"PAL","idprovincia":39,"provincia":"Palencia","comunidad":""},"40":{"provinciaseo":"valladolid","Abreviatura":"VLL","idprovincia":40,"provincia":"Valladolid","comunidad":""},"41":{"provinciaseo":"caceres","Abreviatura":"CAC","idprovincia":41,"provincia":"C�ceres","comunidad":""},"42":{"provinciaseo":"huelva","Abreviatura":"HLV","idprovincia":42,"provincia":"Huelva","comunidad":"AND"},"43":{"provinciaseo":"palmas","Abreviatura":"LPA","idprovincia":43,"provincia":"Las Palmas","comunidad":""}}'
    
    Lib.creaTabla({
        borrar: false,
        titulo: "Provincias",
        donde: "tabla1",
        dragdrop: true,   
    }, JSON.parse(jObj))

    Lib.creaTabla({
        borrar: false,
        titulo: "Provincias",
        donde: "tabla2",
        dragdrop: true,   
    }, JSON.parse(jObj))
}
var Lib = {}

Lib.creaBoton = function(datos) {
    let boton = document.createElement("button");
    let ntexto = document.createTextNode("eliminar");       
    boton.appendChild(ntexto);      
    boton.addEventListener('clic', function() {
        Lib.borraFila(datos)
    }, false)
    return boton;
}

Lib.borraFila = function(datos) {
    delete datos[boton.parentNode.parentNode.cells[0]]
    this.parentNode.parentNode.remove()
}

Lib.creaTabla = (param, datos) => {
    
	if (param==null) {//Opciones por defecto
		param = {
			borrar: false,
            titulo: "Tabla sin titulo",
            donde: false,
            dragdrop: false
		}
	}
	
    const createTR = (tabla,v) => {
        let tablerow = v.cloneNode(true)
        tabla.appendChild(tablerow)
        return tablerow
    }

    let tabla = document.createElement('table')

    if(param.dragdrop) {
        //FALTA TERMINAR
        tabla.addEventListener('dragover', function(e) {
            e.preventDefault()
        })
    
        tabla.addEventListener('drop', function(e) {
            let data = e.dataTransfer.getData("tag")
            if(data=='TD') {
                let ele = e.target.parentNode
                let NEWtablerow = createTR(tabla,ele)
            }
            else if (data=='TR') {
                let NEWtablerow = createTR(tabla,e.target)
            }
        })
    }

    tabla.setAttribute('id', 'otraTabla')
    tabla.setAttribute('border', 1)
    tabla.setAttribute('summary', 'Descripción de la tabla y su contenido')

    let caption = document.createElement('caption')
    let titulo = document.createTextNode(param.titulo)

    caption.appendChild(titulo)
    tabla.appendChild(caption)

    let thead = document.createElement('thead')

    tabla.appendChild(thead)
    thead.insertRow(0)

    let filas=Object.keys(datos)
    let columnas= Object.keys(datos[filas[0]])

    cabecera = document.createElement('th')
    thead.rows[0].appendChild(cabecera)

    for(col of columnas) {
        let cabecera = document.createElement('th')
        cabecera.innerHTML = col
        thead.rows[0].appendChild(cabecera)
    }
    let tbody = document.createElement('tbody')
    tabla.appendChild(tbody)

    let f=0
    let c=0

    for(fila of filas) {
        tbody.insertRow(f)
        tbody.rows[f].addEventListener('dragstart', function(e) {
            e.dataTransfer.setData("tag", e.target.tagName)
        })
        tbody.rows[f].insertCell(c)
        tbody.rows[f].cells[c].innerHTML = fila
        c=1
        for(col of columnas) {
            tbody.rows[f].insertCell(c)
            tbody.rows[f].cells[c].innerHTML = datos[fila][col]
            c++;
        }
        if(param.borrar) {
            tbody.rows[f].insertCell(c)
            tbody.rows[f].cells[c].appendChild(creaBoton(datos))
        }
        f++
        c=0
    }
	if (param.donde==false) {
		document.body.appendChild(tabla)
	} else {
		document.getElementById(param.donde).appendChild(tabla)
	}
}